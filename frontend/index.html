<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyApp - Foco & Evolução</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="auth-screen" style="position:fixed; top:0; left:0; width:100%; height:100%; background:var(--bg-color); z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px;">
        <div class="card" style="width:100%; max-width:400px; text-align:center; padding: 2rem;">
            <h2 style="color:var(--primary-color); margin-bottom:20px;">StudyApp <i class="ph ph-rocket-launch"></i></h2>
            <p style="margin-bottom:20px; color:var(--text-light)">Seus estudos na nuvem.</p>
            
            <input type="email" id="login-email" placeholder="Email" style="margin-bottom:10px; padding:12px; width:100%;">
            <input type="password" id="login-password" placeholder="Senha" style="margin-bottom:20px; padding:12px; width:100%;">
            
            <button id="btn-login" class="btn-primary full-width" style="margin-bottom:10px;">Entrar</button>
            <button id="btn-register" class="btn-secondary full-width">Criar Nova Conta</button>
            
            <p id="login-msg" style="margin-top:15px; color:var(--danger-color); font-weight:bold; font-size:0.9rem; min-height: 20px;"></p>
        </div>
    </div>

    <audio id="timer-sound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock_short.ogg" preload="auto"></audio>

    <nav class="navbar">
        <div class="nav-brand">StudyApp <i class="ph ph-rocket-launch"></i></div>
        
        <ul class="nav-links">
            <li><a href="#" class="nav-link active" data-page="page-home"><i class="ph ph-house"></i> Dashboard</a></li>
            <li><a href="#" class="nav-link" data-page="page-disciplinas"><i class="ph ph-book-open"></i> Disciplinas</a></li>
            <li><a href="#" class="nav-link" data-page="page-ciclo"><i class="ph ph-arrows-clockwise"></i> Ciclo</a></li>
            <li><a href="#" class="nav-link" data-page="page-estatisticas"><i class="ph ph-chart-bar"></i> Estatísticas</a></li>
        </ul>

        <div class="nav-controls">
            <div class="nav-streak" title="Ofensiva (Dias Seguidos)">
                <i class="ph ph-fire-simple"></i> <span id="nav-streak-count">0</span>
            </div>
            <button id="theme-toggle" class="icon-btn" title="Alternar Tema"><i class="ph ph-moon"></i></button>
            
            <button id="btn-admin-panel" class="icon-btn" style="display:none; color: var(--primary-color); border-color:var(--primary-color);" title="Painel Admin"><i class="ph ph-shield-check"></i></button>
            <button id="btn-profile" class="icon-btn" title="Meu Perfil"><i class="ph ph-user"></i></button>
            <button id="btn-logout" class="icon-btn btn-danger-icon" title="Sair"><i class="ph ph-sign-out"></i></button>
            
            <button id="menu-toggle" class="icon-btn">
                <i class="ph ph-list"></i>
            </button>
        </div>
    </nav>

    <main class="container">
        <section id="page-home" class="page active">
            <div class="card" style="margin-bottom: 1.5rem;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                    <h3>Consistência (30 Dias)</h3>
                    <p class="streak-phrase" style="margin:0; font-size:0.9rem;">
                        Sequência: <span id="current-streak-val" class="highlight-number">0</span> | 
                        Recorde: <span id="record-streak-val" class="highlight-number">0</span>
                    </p>
                </div>
                <div id="heatmap-container" class="heatmap-30-grid"></div>
                <div class="heatmap-legend-simple">
                    <span class="legend-item"><span class="day-square-legend missed"></span> Não Estudou</span>
                    <span class="legend-item"><span class="day-square-legend studied"></span> Estudou</span>
                </div>
            </div>

            <div class="summary-grid">
                <div class="summary-card meta">
                    <h4>Meta de Horas</h4>
                    <span id="dash-meta-horas">0h / 4h</span>
                </div>
                <div class="summary-card tempo">
                    <h4>Tempo Hoje</h4>
                    <span id="dash-tempo">0h 0m</span>
                </div>
                <div class="summary-card timer-trigger" id="btn-open-timer-main">
                    <h4><i class="ph ph-timer"></i> Cronômetro</h4>
                    <span id="mini-timer-display">Iniciar</span>
                </div>
                <div class="summary-card acertos">
                    <h4>Acertos Hoje</h4>
                    <span id="dash-acertos">-</span>
                </div>
                <div class="summary-card pendentes">
                    <h4>Revisões</h4>
                    <span id="dash-revisoes">0</span>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="card card-ciclo-hoje">
                    <div class="card-header">
                        <h3 id="ciclo-hoje-titulo"><i class="ph ph-target"></i> Próximas da Fila</h3>
                    </div>
                    <div id="ciclo-hoje-list" class="ciclo-fila-container">
                        <p class="empty-state">Carregando fila...</p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3><i class="ph ph-bell"></i> Revisões Pendentes</h3>
                    </div>
                    <div id="revisoes-pendentes-list">
                        <p class="empty-state">Tudo em dia!</p>
                    </div>
                </div>
            </div>
            <div class="card full-width-card">
                <h3>Resumo Geral por Disciplina</h3>
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Disciplina</th>
                                <th>Questões</th>
                                <th>Acertos</th>
                                <th>Erros</th>
                                <th>% Acertos</th>
                                <th>Tempo Total</th>
                            </tr>
                        </thead>
                        <tbody id="dashboard-table-body"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="page-disciplinas" class="page">
            <h2>Gerenciar Conteúdo</h2>
            <div class="card" style="display:flex; align-items:center; justify-content:space-between;">
                <div>
                    <h3>Minhas Disciplinas</h3>
                    <p style="color:var(--text-light); font-size:0.9rem;">Gerencie matérias e assuntos.</p>
                </div>
                <button id="btn-open-add-disc" class="btn-primary">
                    <i class="ph ph-plus"></i> Nova Disciplina
                </button>
            </div>
            <div class="card">
                <h3>Progresso Detalhado por Assunto</h3>
                <div id="disciplinas-list"></div>
            </div>
        </section>
        
        <section id="page-ciclo" class="page">
            <h2>Configurar Ciclo</h2>
            <div class="dashboard-grid">
                <div class="card">
                    <h3>1. Configuração</h3>
                    <div class="form-group">
                        <label>Meta de Horas Diária</label>
                        <input type="number" id="config-meta-horas" min="1" value="4">
                    </div>
                    <div class="form-group">
                        <label>Quantas matérias exibir na fila?</label>
                        <input type="number" id="ciclo-disciplinas-por-dia" min="1" value="3">
                    </div>
                    <button id="gerar-ciclo-btn" class="btn-primary full-width" style="margin-top:10px;">Salvar & Gerar Nova Fila</button>
                </div>
                <div class="card">
                    <h3>2. Pesos (Qtd. na Fila)</h3>
                    <div id="ciclo-disciplinas-selecao"></div>
                </div>
            </div>
            <div class="card">
                <h3>3. Fila Atual (Ordem de Estudo)</h3>
                <div id="ciclo-resultado-list"></div>
            </div>
        </section>

        <section id="page-estatisticas" class="page">
            <h2>Análise de Desempenho</h2>
            <div class="card">
                <h3>Filtros</h3>
                <form id="stats-filters-form" class="form-grid-3">
                    <div class="form-group">
                        <label>Disciplina</label>
                        <select id="filter-disciplina"><option value="todas">Todas</option></select>
                    </div>
                    <div class="form-group">
                        <label>De</label>
                        <input type="date" id="filter-data-inicio">
                    </div>
                    <div class="form-group">
                        <label>Até</label>
                        <input type="date" id="filter-data-fim">
                    </div>
                </form>
            </div>
            <div class="stats-grid">
                <div class="card stat-card">
                    <h4>Total Horas</h4>
                    <span id="stat-total-horas">0h</span>
                </div>
                <div class="card stat-card">
                    <h4>Total Questões</h4>
                    <span id="stat-total-questoes">0</span>
                </div>
                <div class="card stat-card">
                    <h4>Média Acertos</h4>
                    <span id="stat-media-geral">0%</span>
                </div>
            </div>
            <div class="dashboard-grid">
                <div class="card full-width-card">
                    <h3>% Acertos por Disciplina</h3>
                    <div class="chart-container"><canvas id="chart-acertos"></canvas></div>
                </div>
                <div class="card full-width-card">
                    <h3>Tempo Dedicado (Horas)</h3>
                    <div class="chart-container"><canvas id="chart-tempo"></canvas></div>
                </div>
                <div class="card full-width-card">
                    <h3>Cobertura de Edital</h3>
                    <div class="chart-container-bar"><canvas id="chart-cobertura"></canvas></div>
                </div>
            </div>
            <div class="card">
                <h3>Histórico Detalhado</h3>
                <div id="stat-historico-revisoes"></div>
            </div>
        </section>

    </main>

    <div id="modal-backdrop" class="modal-backdrop"></div>
    
    <div id="timer-modal" class="modal">
        <div class="modal-header">
            <h3><i class="ph ph-timer" style="color:var(--primary-color)"></i> Cronômetro</h3>
            <button class="modal-close-btn"><i class="ph ph-x"></i></button>
        </div>
        <div class="modal-body timer-body">
            <div class="timer-mode-selector">
                <button class="mode-btn active" data-mode="pomodoro">Pomodoro</button>
                <button class="mode-btn" data-mode="livre">Livre</button>
            </div>
            <div id="pomodoro-phases" class="pomodoro-phases">
                <span class="phase-badge active" data-phase="focus">Foco (25m)</span>
                <span class="phase-badge" data-phase="short">Curta (5m)</span>
                <span class="phase-badge" data-phase="long">Longa (15m)</span>
            </div>
            <div class="timer-display-container">
                <div id="timer-display">25:00</div>
            </div>
            <div class="timer-actions">
                <button id="timer-toggle-btn" class="btn-primary btn-lg">Iniciar</button>
                <button id="timer-reset-btn" class="btn-secondary icon-btn" style="width: auto; padding: 0 15px;"><i class="ph ph-arrow-counter-clockwise"></i></button>
            </div>
            <div id="timer-save-container" style="display:none; margin-top:20px; padding-top:15px; border-top:1px solid var(--border-color); animation: fadeIn 0.5s;">
                 <button id="timer-transfer-btn" class="btn-success full-width">
                    <i class="ph ph-pencil-simple"></i> Registrar Tempo
                </button>
            </div>
        </div>
    </div>

    <div id="registro-modal" class="modal">
        <div class="modal-header">
            <h3>Registrar: <span id="reg-modal-title" style="color:var(--primary-color)"></span></h3>
            <button class="modal-close-btn"><i class="ph ph-x"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group" id="reg-disciplina-select-group" style="display:none; border-bottom:1px solid var(--border-color); padding-bottom:15px; margin-bottom:15px;">
                <label>Qual disciplina você estudou?</label>
                <select id="reg-disciplina-select" style="font-weight:600; color:var(--primary-color);"></select>
            </div>
            <input type="hidden" id="reg-disciplina-hidden">
            <div class="form-group">
                <label>Qual assunto você estudou?</label>
                <select id="reg-assunto-select">
                    <option value="">Selecione um assunto...</option>
                </select>
                <input type="text" id="reg-novo-assunto" placeholder="Ou digite um novo assunto..." style="margin-top:10px;">
            </div>
            <div class="form-group checkbox-row" style="background: rgba(34, 197, 94, 0.1); padding: 10px; border-radius: 8px; border: 1px solid var(--success-color);">
                <input type="checkbox" id="reg-finalizado" style="width:auto; transform: scale(1.3); accent-color: var(--success-color);">
                <label for="reg-finalizado" style="margin:0; font-weight:600; cursor:pointer; color: var(--text-color);">
                    Marcar assunto como <span style="color:var(--success-color)">CONCLUÍDO</span>
                </label>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label>Total de Questões</label>
                    <input type="number" id="reg-questoes" min="0" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Total de Acertos</label>
                    <input type="number" id="reg-acertos" min="0" placeholder="0">
                </div>
            </div>
            <div class="form-group">
                <label>Tempo Total (minutos)</label>
                <input type="number" id="reg-tempo" min="0" placeholder="0">
            </div>
        </div>
        <div class="modal-footer">
            <button id="btn-salvar-registro" class="btn-primary full-width">Salvar Registro</button>
        </div>
    </div>

    <div id="revisao-modal" class="modal">
        <div class="modal-header">
            <h3>Concluir Revisão</h3>
            <button class="modal-close-btn"><i class="ph ph-x"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="rev-id">
            <input type="hidden" id="rev-idx">
            <p style="margin-bottom:15px; color:var(--text-color);">
                <strong>Assunto:</strong> <span id="rev-modal-assunto"></span>
            </p>
            <div class="form-grid">
                <div class="form-group">
                    <label>Tempo (minutos)</label>
                    <input type="number" id="rev-tempo" min="0" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Questões</label>
                    <input type="number" id="rev-questoes" min="0" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Acertos</label>
                    <input type="number" id="rev-acertos" min="0" placeholder="0">
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="btn-salvar-revisao" class="btn-success full-width">Concluir Revisão</button>
        </div>
    </div>

    <div id="add-disciplina-modal" class="modal">
        <div class="modal-header">
            <h3>Nova Disciplina</h3>
            <button class="modal-close-btn"><i class="ph ph-x"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Nome da Disciplina</label>
                <input type="text" id="new-disc-name" placeholder="Ex: Direito Administrativo">
            </div>
            <div class="form-group">
                <label>Assuntos (separados por ponto e vírgula)</label>
                <textarea id="new-disc-subjects" rows="5" placeholder="Ex: Atos Administrativos; Poderes; Licitações"></textarea>
                <p style="font-size:0.8rem; color:var(--text-light); margin-top:5px;">
                    Dica: Copie o edital e separe os tópicos por <strong>;</strong>
                </p>
            </div>
        </div>
        <div class="modal-footer">
            <button id="btn-save-new-disc" class="btn-primary">Salvar Disciplina</button>
        </div>
    </div>

    <div id="profile-modal" class="modal">
        <div class="modal-header">
            <h3>Meu Perfil</h3>
            <button class="modal-close-btn"><i class="ph ph-x"></i></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Nome de Usuário</label>
                <input type="text" id="profile-name">
            </div>
            <div class="form-group">
                <label>Email (Não alterável)</label>
                <input type="text" id="profile-email" disabled style="background: rgba(0,0,0,0.05);">
            </div>
            <div class="form-group">
                <label>Nova Senha (Deixe em branco para manter)</label>
                <input type="password" id="profile-password" placeholder="Nova senha...">
            </div>
            <hr style="margin: 20px 0; border: 0; border-top: 1px solid var(--border-color);">
            <div style="text-align: center;">
                <p style="color:var(--danger-color); font-size: 0.9rem; margin-bottom:10px;">Zona de Perigo</p>
                <button id="btn-delete-account" class="btn-danger btn-sm">Excluir Minha Conta</button>
            </div>
        </div>
        <div class="modal-footer">
            <button id="btn-save-profile" class="btn-primary full-width">Salvar Alterações</button>
        </div>
    </div>

    <div id="admin-modal" class="modal">
        <div class="modal-header">
            <h3>Painel Admin</h3>
            <button class="modal-close-btn"><i class="ph ph-x"></i></button>
        </div>
        <div class="modal-body">
            <div class="card" style="margin-bottom: 20px; padding: 15px; border: 1px solid var(--border-color);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <strong>Novos cadastros:</strong>
                    <button id="btn-toggle-reg" class="btn-sm btn-secondary">Carregando...</button>
                </div>
            </div>
            <h4>Usuários Cadastrados</h4>
            <div class="table-responsive">
                <table class="data-table">
                    <thead><tr><th>Nome</th><th>Email</th><th>Ação</th></tr></thead>
                    <tbody id="admin-users-list"></tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div id="toast-container"></div>
    <script src="script.js"></script>
</body>
</html>